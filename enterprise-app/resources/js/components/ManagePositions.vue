<template>
  <div class="p-8 bg-[#F8FAFC] min-h-screen font-jakarta text-slate-800">

    <div class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
      <div>
        <h2 class="text-2xl font-bold text-slate-900 tracking-tight">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô</h2>
        <p class="text-sm text-slate-400 mt-1 font-medium font-ibm">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</p>
      </div>
      <div class="flex gap-3">
        <button @click="openCreateModal"
          class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-2xl shadow-lg shadow-blue-200 transition-all flex items-center gap-2 font-bold text-sm active:scale-95">
          <span class="text-lg">+</span> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡∏°‡πà
        </button>
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8">
      <div class="bg-white p-6 rounded-4xlrder border-slate-100 shadow-sm flex items-center gap-4">
        <div class="h-12 w-12 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center text-xl">üíº</div>
        <div>
          <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
          <h3 class="text-2xl font-black text-slate-800">{{ positions.length }}</h3>
        </div>
      </div>
    </div>

    <div class="bg-white p-5 rounded-4xl border border-slate-100 shadow-sm mb-6 flex flex-col md:flex-row gap-4">
      <div class="relative grow">
        <input type="text" v-model="searchQuery"
          class="w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-100 rounded-2xl focus:ring-4 focus:ring-blue-50 focus:border-blue-400 outline-none transition-all text-sm font-medium font-ibm"
          placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô/‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡πÑ‡∏ó‡∏¢/‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)..." />
        <span class="absolute left-4 top-3.5 text-slate-400">üîç</span>
      </div>
      <select v-model="filterType"
        class="w-full md:w-44 border border-slate-100 rounded-2xl px-4 py-3 bg-slate-50 text-slate-600 font-bold text-sm outline-none focus:ring-4 focus:ring-blue-50">
        <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á</option>
        <option value="‡∏ñ‡∏≤‡∏ß‡∏£">‡∏ñ‡∏≤‡∏ß‡∏£</option>
        <option value="‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß">‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</option>
      </select>
    </div>

    <div class="bg-white rounded-[2.5rem] border border-slate-100 shadow-xl shadow-slate-200/50 overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left border-collapse font-ibm">
          <thead class="bg-slate-50/50 text-slate-400 font-bold border-b border-slate-50">
            <tr class="text-[10px] uppercase tracking-[0.15em]">
              <th class="px-8 py-5 text-center w-20">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
              <th class="px-6 py-5">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
              <th class="px-6 py-5">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
              <th class="px-6 py-5">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á</th>
              <th class="px-6 py-5 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
              <th class="px-6 py-5 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-50">
            <tr v-for="(item, index) in filteredPositions" :key="item.id"
              class="hover:bg-blue-50/30 transition-colors group">

              <!-- ‡∏•‡∏≥‡∏î‡∏±‡∏ö -->
              <td class="px-8 py-6 text-center text-slate-300 font-bold">
                {{ index + 1 }}
              </td>

              <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô -->
              <td class="px-6 py-6">
                <div class="font-bold text-slate-700">
                  {{ item.employee_name }}
                </div>
              </td>

              <!-- ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á -->
              <td class="px-6 py-6">
                <div class="font-bold text-slate-700 group-hover:text-blue-600">
                  {{ item.name }}
                </div>
                <div class="text-[11px] text-slate-400 italic">
                  {{ item.name_en }}
                </div>
              </td>

              <!-- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á -->
              <td class="px-6 py-6">
                <span :class="item.type === '‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß'
                  ? 'bg-amber-50 text-amber-600 border-amber-100'
                  : 'bg-blue-50 text-blue-600 border-blue-100'"
                  class="px-3 py-1.5 rounded-xl text-[10px] font-bold border">

                  {{ item.type }} {{ item.days ? `(${item.days} ‡∏ß‡∏±‡∏ô)` : '' }}
                </span>
              </td>

              <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
              <td class="px-6 py-6 text-center">
                <span class="px-4 py-1.5 rounded-full text-[10px] font-black 
                 bg-emerald-50 text-emerald-600 border">
                  ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                </span>
              </td>

              <!-- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ -->
              <td class="px-6 py-6 text-center">
                <div class="flex items-center justify-center gap-3">
                  <button @click="openEditModal(item)"
                    class="h-9 w-9 rounded-xl bg-slate-100 hover:bg-blue-600 hover:text-white">
                    ‚úèÔ∏è
                  </button>

                  <button @click="confirmDelete(item)"
                    class="h-9 w-9 rounded-xl bg-slate-100 hover:bg-rose-500 hover:text-white">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>

            <tr v-if="filteredPositions.length === 0">
              <td colspan="5" class="px-6 py-12 text-center text-slate-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div v-if="showModal" class="fixed inset-0 z-100 flex items-center justify-center p-4 bg-slate-900/40 ">
      <div class="bg-white w-full max-w-2xl rounded-[2.5rem] shadow-2xl overflow-hidden animate-in zoom-in-95 font-ibm">
        <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-white">
          <h3 class="text-lg font-bold text-blue-600">{{ isEditMode ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡∏°‡πà' }}</h3>
          <button @click="showModal = false"
            class="text-slate-300 hover:text-slate-500 transition-colors text-xl">‚úï</button>
        </div>
        <div class="p-8 grid grid-cols-2 gap-6">
          <div class="col-span-1">
            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-2 ml-1 tracking-widest">‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
              *</label>
            <input v-model="form.name" type="text"
              class="w-full px-4 py-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm focus:border-blue-400 outline-none transition-all" />
          </div>
          <div class="col-span-1">
            <label
              class="block text-[10px] font-bold text-slate-400 uppercase mb-2 ml-1 tracking-widest">‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•
              *</label>
            <input v-model="form.name_en" type="text"
              class="w-full px-4 py-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm focus:border-blue-400 outline-none transition-all" />
          </div>
          <div class="col-span-1">
            <label
              class="block text-[10px] font-bold text-slate-400 uppercase mb-2 ml-1 tracking-widest">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á</label>
            <select v-model="form.type"
              class="w-full px-4 py-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm focus:border-blue-400 outline-none cursor-pointer font-bold">
              <option value="‡∏ñ‡∏≤‡∏ß‡∏£">‡∏ñ‡∏≤‡∏ß‡∏£ (Permanent)</option>
              <option value="‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß">‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (Contract)</option>
            </select>
          </div>
          <div v-if="form.type === '‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß'" class="col-span-1">
            <label
              class="block text-[10px] font-bold text-amber-600 uppercase mb-2 ml-1 tracking-widest">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏±‡∏ç‡∏ç‡∏≤</label>
            <input v-model="form.days" type="number"
              class="w-full px-4 py-3 bg-amber-50 border border-amber-100 text-amber-700 rounded-2xl text-sm font-bold outline-none" />
          </div>
        </div>
        <div class="p-8 bg-slate-50/50 flex justify-center gap-4">
          <button @click="showModal = false"
            class="px-8 py-2.5 rounded-2xl border border-slate-200 text-slate-400 font-bold text-sm hover:bg-white transition-all">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button @click="handleSave"
            class="px-10 py-2.5 rounded-2xl bg-blue-600 text-white font-bold shadow-lg shadow-blue-100 text-sm hover:bg-blue-700 active:scale-95 transition-all">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
      </div>
    </div>

  </div>
</template>

<script setup>
import { ref, reactive, computed } from 'vue';
import Swal from 'sweetalert2';

// --- Configuration ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SweetAlert2 ‡∏™‡πÑ‡∏ï‡∏•‡πå iRecruit ---
const swalConfig = {
  customClass: {
    popup: 'recruit-swal-popup',
    title: 'recruit-swal-title',
    confirmButton: 'recruit-swal-confirm',
    cancelButton: 'recruit-swal-cancel'
  },
  buttonsStyling: false
};

// --- Data & States ---
const showModal = ref(false);
const isEditMode = ref(false);
const searchQuery = ref('');
const filterType = ref('');

const positions = ref([
  {
    id: 1,
    employee_name: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ',
    name: '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô',
    name_en: 'Coordinator',
    type: '‡∏ñ‡∏≤‡∏ß‡∏£',
    days: null
  },
  {
    id: 2,
    employee_name: '‡∏ß‡∏¥‡∏†‡∏≤ ‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå',
    name: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
    name_en: 'Warehouse Staff',
    type: '‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß',
    days: 90
  },
]);

const form = reactive({
  id: null,
  name: '',
  name_en: '',
  type: '‡∏ñ‡∏≤‡∏ß‡∏£',
  days: null
});

// --- Filter Logic ---
const filteredPositions = computed(() => {
  return positions.value.filter(p => {
    const matchSearch = p.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
      p.name_en.toLowerCase().includes(searchQuery.value.toLowerCase());
    const matchType = filterType.value === '' || p.type === filterType.value;
    return matchSearch && matchType;
  });
});

// --- Actions ---
const openCreateModal = () => {
  isEditMode.value = false;
  Object.assign(form, { id: null, name: '', name_en: '', type: '‡∏ñ‡∏≤‡∏ß‡∏£', days: null });
  showModal.value = true;
};

const openEditModal = (item) => {
  isEditMode.value = true;
  Object.assign(form, { ...item });
  showModal.value = true;
};

const handleSave = () => {
  // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
  Swal.fire({
    ...swalConfig,
    title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å?',
    text: "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà",
    icon: 'question',
    showCancelButton: true,
    confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô',
    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
    confirmButtonColor: '#2563eb'
  }).then((result) => {
    if (result.isConfirmed) {
      if (isEditMode.value) {
        const index = positions.value.findIndex(p => p.id === form.id);
        if (index !== -1) positions.value[index] = { ...form };
      } else {
        const newId = positions.value.length > 0 ? Math.max(...positions.value.map(p => p.id)) + 1 : 1;
        positions.value.push({ ...form, id: newId });
      }
      showModal.value = false;

      // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
      Swal.fire({
        ...swalConfig,
        icon: 'success',
        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
        timer: 1500,
        showConfirmButton: false
      });
    }
  });
};

const confirmDelete = (item) => {
  Swal.fire({
    ...swalConfig,
    title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?',
    text: `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á "${item.name}"`,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
    confirmButtonColor: '#f43f5e'
  }).then((result) => {
    if (result.isConfirmed) {
      positions.value = positions.value.filter(p => p.id !== item.id);
      Swal.fire({
        ...swalConfig,
        icon: 'success',
        title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß',
        timer: 1500,
        showConfirmButton: false
      });
    }
  });
};
</script>

<style>
/* Font Configuration */
@import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');

.font-jakarta {
  font-family: 'Plus Jakarta Sans', sans-serif;
}

.font-ibm {
  font-family: 'IBM Plex Sans Thai', sans-serif;
}

/* Custom SweetAlert2 Style */
.recruit-swal-popup {
  border-radius: 2.5rem !important;
  padding: 2.5rem !important;
  font-family: 'IBM Plex Sans Thai', sans-serif !important;
}

.recruit-swal-title {
  font-size: 1.5rem !important;
  font-weight: 700 !important;
  color: #1e293b !important;
}

.recruit-swal-confirm {
  background-color: #2563eb !important;
  color: white !important;
  border-radius: 1.25rem !important;
  padding: 0.8rem 2.5rem !important;
  font-weight: 700 !important;
  margin: 0.5rem !important;
  box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.2) !important;
}

.recruit-swal-cancel {
  background-color: #f1f5f9 !important;
  color: #64748b !important;
  border-radius: 1.25rem !important;
  padding: 0.8rem 2.5rem !important;
  font-weight: 700 !important;
  margin: 0.5rem !important;
}

/* Animations */
.animate-in {
  animation: zoomIn 0.2s ease-out;
}

@keyframes zoomIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }

  to {
    opacity: 1;
    transform: scale(1);
  }
}

</style>